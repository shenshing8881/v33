<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virals</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        <!-- Your existing CSS remains unchanged -->
    </style>
</head>
<body>
    <!-- Your existing body structure remains unchanged -->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Telegram.WebApp.ready();
            Telegram.WebApp.BackButton.show();
        });

        function handleClick(event, link, tabId) {
            event.preventDefault();
            // Use Telegram's openLink for external links or navigation within Telegram
            if (tabId === 'newTab' || tabId === 'task2Tab') {
                Telegram.WebApp.openLink(link);
            } else {
                // For internal navigation within your Mini App
                Telegram.WebApp.openLink(`t.me/asiaviralsxx_bot/virals?startapp=${tabId}`);
            }
            
            manageTabVisibility(tabId);
        }

        function manageTabVisibility(tabId) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.style.display = 'none');
            
            switch (tabId) {
                case 'newTab':
                    setTimeout(() => {
                        document.getElementById('task2Tab').style.display = 'block';
                    }, 7000);
                    break;
                case 'task2Tab':
                    setTimeout(() => {
                        document.getElementById('tryAgainTab').style.display = 'block';
                        document.querySelector('.gif-background').style.display = 'block';
                        document.querySelector('.title-box').style.display = 'none';
                    }, 8000);
                    break;
                case 'tryAgainTab':
                    document.getElementById('tryAgainTab').style.display = 'none';
                    document.querySelector('.gif-background').style.display = 'none';
                    document.querySelector('.waiting-gif').style.display = 'block';
                    setTimeout(() => {
                        document.querySelector('.waiting-gif').style.display = 'none';
                        document.getElementById('gcLink').style.display = 'block';
                        document.getElementById('bonusBox').style.display = 'block';
                        document.querySelector('.title-box').style.display = 'none';
                    }, 17000);
                    break;
                case 'gcLink':
                    document.getElementById('gcLink').style.display = 'block';
                    break;
            }
        }

        function showBonusInstruction() {
            const instruction = document.getElementById('bonusInstruction');
            const linkBox = document.getElementById('linkBox');
            instruction.style.display = 'block';
            instruction.classList.add('blink');
            document.getElementById('bonusBox').style.display = 'none';
            setTimeout(() => {
                linkBox.style.display = 'block';
            }, 20000);
        }

        // Adjust event listeners to use handleClick with the new URL structure
        document.querySelector('#tryAgainTab a').addEventListener('click', function(e) {
            handleClick(e, 't.me/asiaviralsxx_bot/virals?startapp=tryAgainTab', 'tryAgainTab');
            e.preventDefault(); // Prevent default action since we're using Telegram's navigation
        });

        document.querySelector('#gcLink a').addEventListener('click', function(e) {
            handleClick(e, 't.me/asiaviralsxx_bot/virals?startapp=gcLink', 'gcLink');
            e.preventDefault(); // Prevent default action since we're using Telegram's navigation
        });

        document.addEventListener('contextmenu', event => {
            if (event.target.closest('#tryAgainTab')) {
                event.preventDefault();
            }
        });

        let holdTimer;

        document.querySelector('#tryAgainTab').addEventListener('touchstart', function(e) {
            holdTimer = setTimeout(function() {
                e.preventDefault();
            }, 500); // 500ms is often considered a 'long press'
        });

        document.querySelector('#tryAgainTab').addEventListener('touchend', function(e) {
            clearTimeout(holdTimer);
        });

        const stars = document.querySelectorAll('.star');
        stars.forEach(star => {
            star.addEventListener('animationiteration', function() {
                star.style.animation = 'none';
                setTimeout(() => {
                    star.style.animation = '';
                }, 0);
            });
        });
    </script>
</body>
</html>